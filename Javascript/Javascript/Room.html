<html> 
    <head>
        <title>Room:</title>

        <style>
         
        </style>
        
    </head>
    <body onload = "drawGrids();">
        <h3></h3>
        <div id="gridPlaceHolder"></div>
        
    </body>
</html>
<script src ="Cell.js"></script>
<script>

var cellsMap = new Map();
var playerShipsMap = new Map();

var placedShips = new Map();

var selectedShipID;
var selectedShipLength = 0;

localStorage.getItem('RoomName');

function drawGrids()
{
    let gameBoard = document.createElement('table');
    gameBoard.id = 'grid';
    gameBoard.style.outline = '1px solid Black';
    
    document.body.appendChild(gameBoard);

    let gridCellSize = 50;

    for(let y = 1; y <= 10; y++)
    {
        let row = document.createElement('tr');
        gameBoard.appendChild(row);
        for(let x = 1; x <= 10; x++)
        {
            let cell = document.createElement('td');
            cell.id = `x${x}y${y}`;
            cell.style.width = `${gridCellSize}px`;
            cell.style.height = `${gridCellSize}px`;
            cell.style.outline = '1px solid Black';
            cell.onmouseover = () =>    {
                                            if(cell.dataset.isSelected == "false" && cell.dataset.isAvailableCell == 'false') 
                                            {
                                                cell.style.backgroundColor = 'LightBlue'; 
                                            }
                                        };
            cell.onmouseout = () => {
                                            if(cell.dataset.isSelected == "false" && cell.dataset.isAvailableCell == 'false')
                                            {
                                                cell.style.backgroundColor = 'Transparent';
                                            }
                                    };
            cell.onclick = () => { if(selectedShipID != null) {selectedCell(cell.id); }};
            cell.dataset.isSelected = 'false';
            cell.dataset.x = x;
            cell.dataset.y = y;
            cell.dataset.isAvailableCell = 'false';
            cellsMap.set(cell.id, cell);    
            row.appendChild(cell);
        }
    }

    let shipsGrid = document.createElement('table');
    shipsGrid.id = 'shipsGrid';
    shipsGrid.style.outline = '1px solid Black';

    shipsGrid.style.position = 'relative';
    shipsGrid.style.top = '50px';

    document.body.appendChild(shipsGrid);
    for(let i = 1; i <= 5; i++)
    {
        let shipsRow = document.createElement('tr');
        shipsGrid.appendChild(shipsRow);
        
        let shipsCell = document.createElement('td');

        switch(i)
        {
            case 1:
                shipsCell.id = '1';
                shipsCell.dataset.name = 'AircraftCarrier';
                shipsCell.dataset.shipLength = 5;
                break;

            case 2:
                shipsCell.id = '2';
                shipsCell.dataset.name = 'Battleship';
                shipsCell.dataset.shipLength = 4;
                break;

            case 3:
                shipsCell.id = '3';
                shipsCell.dataset.name = 'Submarine';
                shipsCell.dataset.shipLength = 3;
                break;
            
            case 4:
                shipsCell.id = '4';
                shipsCell.dataset.name = 'Cruiser';
                shipsCell.dataset.shipLength = 3;
                break;
            
            case 5:
                shipsCell.id = '5';
                shipsCell.dataset.name = 'Destroyer';
                shipsCell.dataset.shipLength = 2;
                break;
        }
        shipsCell.style.width = '500px';
        shipsCell.style.height = '50px';
        shipsCell.style.outline = '1px solid Black';
        
        shipsCell.onmouseover = () =>   { 
                                            if(shipsCell.dataset.isSelected == 'false')
                                            {    
                                                shipsCell.style.backgroundColor = 'LightGreen';
                                            }
                                        };
        shipsCell.onmouseout = () => {  if(shipsCell.dataset.isSelected == 'false')
                                        {
                                            shipsCell.style.backgroundColor = 'Transparent';
                                        }
                                    };

        shipsCell.onclick = () => {selectedShipsCell(shipsCell.id); };
        playerShipsMap.set(shipsCell.id, shipsCell);
        shipsRow.appendChild(shipsCell);

        shipsCell.dataset.isSelected = 'false';

    }
}

var availableEndCells = new Map();

function selectedCell(cellID)
{
    //Display all the available end cells
    let cell = cellsMap.get(cellID);    
    cell.dataset.isSelected = "true";
    if(selectedShipID != null)
    {
        for(let y = 1; y < 11; y++)
        {
            for(let x = 1; x < 11; x++)
            {
                let cell = cellsMap.get(`x${x}y${y}`);
                cell.style.backgroundColor = 'White';
                cell.isSelected = 'false';
                cell.isAvailableCell = 'false';

                //Remove previous available end cells
                availableEndCells.set('UpperEndCell', null);
                availableEndCells.set('LowerEndCell', null);
                availableEndCells.set('RightEndCell', null);
                availableEndCells.set('LeftEndCell', null);
                
            }
        }

        cell.style.backgroundColor = 'DarkBlue';
    
        if(asInt(cell.dataset.x) - asInt(selectedShipLength) + 1 > 0)
        {
            let availableCell = cellsMap.get(`x${asInt(cell.dataset.x) - asInt(selectedShipLength) + 1}y${cell.dataset.y}`);        
            setAvailableCell('LeftEndCell', availableCell);
        }
        if(asInt(cell.dataset.x) + asInt(selectedShipLength) - 1 < 11)
        {
            let availableCell = cellsMap.get(`x${asInt(cell.dataset.x) + asInt(selectedShipLength) - 1}y${cell.dataset.y}`);
            setAvailableCell('RightEndCell', availableCell);
        }
        if(asInt(cell.dataset.y) - asInt(selectedShipLength) + 1 > 0)
        {
            let availableCell = cellsMap.get(`x${cell.dataset.x}y${asInt(cell.dataset.y) - asInt(selectedShipLength) + 1}`);
            setAvailableCell('UpperEndCell', availableCell);
        }
        if(asInt(cell.dataset.y) + asInt(selectedShipLength) - 1 < 11)
        {
            let availableCell = cellsMap.get(`x${cell.dataset.x}y${asInt(cell.dataset.y) + asInt(selectedShipLength) - 1}`);
            setAvailableCell('LowerEndCell', availableCell);
        }
    }
}

function setAvailableCell(key, availableCell)
{
    availableCell.isAvailableCell = 'true';
    availableCell.style.backgroundColor = 'LightBlue';
    availableEndCells.set(`${key}`, availableCell);
}

function asInt(value)
{
    //Casts value as integer
    return value * 1;
}

function selectedShipsCell(cellID)
{
    let cell = playerShipsMap.get(cellID);

    for(let i = 1; i < 6; i++)
    {
        var cell = playerShipsMap.get(`${i}`);
        cell.backgroundColor = 'White';
        cell.isSelected = 'false';
    }

    cell.dataset.isSelected = 'true';

    if(placedShips.get(cellID) == null)
    {
        selectedShipID = cellID;
        selectedShipLength = cell.dataset.shipLength;
    }
}

function callAPI(url, callback, body)
    {
        var xhr = new XMLHttpRequest();
        xhr.open(body === undefined ? 'GET' : 'POST', url, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onload = () => callback(JSON.parse(xhr.responseText));

        if(body === undefined)
        {
            xhr.send();
        }
        else
        {
            xhr.send(JSON.stringify(body));
        }
    }
</script>